<!DOCTYPE html>
<meta charset="utf-8">
<style>


</style>
<body>
<script src="//d3js.org/d3.v4.min.js"></script>
<script>

var coords = [];

d3.xml("data.xml", function(error, data) {
  if (error) throw error;

  data = [].map.call(data.querySelectorAll("country"), function(d) {

    return {
      //countryname: d.querySelector("countryName").textContent,
      countrycode: d.querySelector("countryCode").textContent,

    };
  });

  data.forEach(function(d){

    
    var url = 'http://ws.geonames.org/search?country='+d.countrycode+'&maxRows=1&username=demo';

    d3.xml(url, function(error, eldata){
      if (error) throw error;

        coords.push({
          countrycode : eldata.querySelector("countryCode").textContent,
          lat : eldata.querySelector("lat").textContent,
          lan : eldata.querySelector("lng").textContent
        });

    });


  });

  console.log(coords);
  download(JSON.stringify(coords), 'countries-coords.json', 'text/plain');
});

function download(text, name, type) {
  var a = document.createElement("a");
  var file = new Blob([text], { type: type });
  a.href = URL.createObjectURL(file);
  a.download = name;
  a.click();
}

</script>




















